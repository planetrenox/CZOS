--------------------------------------------------
© 2018 Type74 nonact / InsideThighs
Version 1.0.8
web			http://type74.lsrv.jp/
mail			nonact@type74.lsrv.jp
uploader		https://ux.getuploader.com/type74/
--------------------------------------------------
メインシェーダー
TypeA/Toon02		基本のシェーダー

TypeA/Toon02Edge	Toon02にアウトラインを追加したシェーダー

サブシェーダー
TypeA/Toon02Fade	ステンシルマスクの一部を半透明にするシェーダー

TypeA/Toon02FadeEdge	Toon02にアウトラインを追加したシェーダー

2019以降用
TypeA/	Toon03
		Toon03Edge
		Toon03Fade
		Toon03FadeEdge

--------------------------------------------------
VRChat用に作成を開始したシェーダですが、
通常のアニメ調・イラスト調表現用途にも利用出来ます。
(VRChat用にカラースペースリニアで調整しています。)

・ステンシルマスク利用時の注意
半透明の部分を描画する為に描画パスが増えるので、
ステンシル内の一部を半透明にしたい場合以外はFadeのシェーダーは必要ありません。

・VRChatでの利用時の注意点
現在のVRChatではレンダーキュー及びレンダータイプが無視される不具合は解消しているので、
以前のように複数ファイルで対処する必要がなくなっています。
その為、不要になったVRChat用のサンプルファイルは削除しました。

ステンシルの設定やVRC利用時の注意点など詳細はサイトで確認して下さい。
http://type74.lsrv.jp/stencil-in-taas/
http://type74.lsrv.jp/use-with-vrchat/

http://type74.lsrv.jp/sample-using-blender/
blenderを利用して各テクスチャを作成する場合に便利なマテリアル(ノード使用)の例を含んだblendfile、
カラーランプをテクスチャに出力して簡単にToonテクスチャを作るblendfile
頂点グループのウェイト値を頂点カラーのRに書き込むサンプルのpythonファイルを配布しています。


・新規インポート直後にマテリアルのプレビューがグレーの球になる事があります。
プロジェクトウインドウが更新されない為に起こっている現象のようで、再描画を促すと正常に表示されます。
プレービューをクリック、パラメータを変更する、マテリアルのReImport、プロジェクトの再読み込み、など。


--------------------------------------------------

--------------------------------------------------
--------------------------------------------------
TypeA/Toon02
	Inspectorの説明
--------------------------------------------------
Rendering Settings
--------------------------------------------------
Rendering Mode
    レンダリングモードを設定します。

RenderQueue
    RenderQueueを設定します。

SrcBlend
    レンダリングモードが、CutOut,Fade,Transparentの時のブレンド方法を指定します。

DstBlend
    レンダリングモードが、CutOut,Fade,Transparentの時のブレンド方法を指定します。

AlphaCutoff
    レンダリングモードが、CutOutの時のカットオフ値を設定します。

ColorMask
    書き込みチャンネルの設定。チェック有りで書き込み。

AlphaToMask
    アルファチャンネルをマスクするかどうか。チェックでマスク有り。

ZWrite
    デプスバッファに書き込むかどうかを設定します。

Culling
    カリングの仕方を指定します。

ZTest
	デプステストの方法を設定します。

ObjectColor
    オブジェクトの色を指定します。
    通常は(r,g,b)=(1.0,1.0,1.0)=白から変更する必要はありません。
    レンダリングモードが透過の場合、アルファが透明度として使用出来ます。

--------------------------------------------------
Stencil Settings
--------------------------------------------------
ReferenceValue
    マスクする時・される時に参照する値を設定します。

ReadMask
    ステンシルバッファを読み込む時、どのビットから影響を受けるかを指定するマスク値を指定します。

WriteMask
    ステンシルバッファを書き込む時、どのビットに影響させるかを指定するマスク値を指定します。

ComparisonFunction
    バッファの現在の内容と基準値を、どのように比較するかを設定します。

PassOperation
    各テストにパスした場合、バッファの内容をどうするかを設定します。

FailOperation
    ステンシルテストに失敗した場合、バッファの内容をどうするかを設定します。

ZFailOperation
    デプステストに失敗した場合、バッファの内容をどうするかを設定します。

--------------------------------------------------
Toon02Fade / Toon02FadeEdge の追加設定項目
--------------------------------------------------
FadeMask settings
readMask
    フェードさせたいビットを設定します。
    このマスク値から漏れた部分は通常の完全透過のマスク結果となります。
    一部を半透明化させたい場合に使用します。

Stencil Fade
    フェードの強さを設定します。

--------------------------------------------------
--------------------------------------------------
Main Color Settings
--------------------------------------------------
BaseColor
    基本色のテクスチャを設定します。
    テクスチャが未指定の場合、カラーピッカーで設定した色が使用されます。

ShadowColor
    影色のテクスチャを設定します。
    テクスチャが未指定の場合、カラーピッカーで設定した色が使用されます。

ShadowMap
    手動で影を付けたい場所を指定する為に使用します。
    影にしたい部分を黒又は黒に近い色にし、明るくしておきたい部分は白にします。
    ライティングの結果やシステムシャドウの値などと合成した後の値がToonの色分けに使用されます。
    このマップは２値の必要はなくグラデーションさせれば影の付き方が半固定のようになります。

Toon
    このテクスチャで基本色と影色に振り分けます。
    テクスチャの状態でくっきり分けたり暈したり出来ます。

Lighting Direction
    ライティングの方法を指定します。

    0でView方向、1でLight方向、からのライティングになります。
    スライダーで双方を混合出来ます。

    View    システムシャドウ以外、常に視点方向から照らしているような陰影付けになります。

    Light   BasePassで利用可能なライト情報全ての中で一番明るい方向に光源があるものとして陰影付けをします。
            追加のピクセルライティング(AddPass)で処理されるライトは情報が取れない為、これに含まれません。

			光源判断に含まれるもの。
			・メインのライト（一番明るいDirectional Light）
			・頂点シェーディングされるポイントライト（４つまでのNotImportantのもの）
			・LightProbから得られる環境光。
			Unityマニュアルの「フォワードレンダリングパスの詳細」の説明でPer-VertexとSHに含まれるものとメインのライトです。

    複数ライティングによって塗分け部分が何重にも重なる現象防止の為、Viewを含めた各方向(強さ含む)情報から、
    一番影響の強い方向に光源があるものとして陰影付けします。
　　
	1のLightに設定した場合で方向を示す情報が無い場合、ワールド空間上でカメラの上方に光源があるものとして処理します。
	Viewが混合されている場合で方向を示す情報が無い場合、View方向(0に設定)の扱いになります。

AnchorPoint     1.0.7で追加
    メッシュに設定したアンカーオーバーライドが効かない場合の応急処置。
    メッシュ位置とアンカーオーバーライドに使用したい位置の距離を指定します。
    一時的に空のオブジェクトを作り、ツリー上で移動させた後のtransformのpositionの値を見る事で調べる事が出来ます。

以下の4つの設定で法線を変化させ、影の付き方を調整出来ます。

Expand Spherically
    面法線を球状に拡張します。1で完全な球状。

Spherical Center
    球状に拡張する際の中心位置を指定。0でMeshの中心位置。
    同一オブジェクト内でMeshが分かれている場合、MeshRenderer>>Bounds>>Centerの値を指定する事でそのMeshの中心を指定出来ます。

Normal Scale X,Y,Z
    頂点の法線を指定座標毎に拡大縮小します。
	この設定を変えると本来のモデルよりも凹凸が大きい又は小さいような陰影になります。

Normal Rotation X,Y
    頂点の法線を指定座標軸毎に回転させます。
	この設定を変えるとライトが回転したかのように陰影の付き方が変化します。


MainLighting Affect
    GIを含めたメインライティングの影響度を設定します。

AmbientLight Color
    MainLightingAffcetに含まれる環境光の成分をそのまま使うか明るさ情報のみとして利用するか指定します。
    メインのライティングはそのままに環境光の色成分だけ弱めたい時などに調整します。
    0で明るさのみ、1で通常の色。

AmbientTilt     v1.0.7で追加
    環境光の効き目を調節します。
    人体モデルなど縦長なモデルで上下端付近の環境光の影響が強すぎる場合に数値を下げる事で効き目を和らげることができます。
    様々な要因と好みがありますが、人体モデルの場合、0.7前後が程よいと感じます。
    足元だけ急激に変化する場合があるという場合に調節します。

AddLighting Affect
    追加のライトがある場合、追加ライトの影響度を設定します。

  上記２つをゼロにした場合、影とならない場所はテクスチャの色がそのまま使用されます。

Saturated Value
    ライティングによる白飛びの飽和値を調節します。
	1.0以上の数値を幾つまで使うかの設定になります。

Shadow Affect
    ライティング計算の陰影とShadowMapで指定した部分の影の影響度を設定します。

SystemShadow Affect
    unityのシステムシャドウを使用している場合、その影響度を設定します。

AddSystemShadow Affect
    追加のライトでunityのシステムシャドウを使用している場合、その影響度を設定します。

Handl Shadow
	システムシャドウをディフューズの陰影に含めるかどうかを設定します。

	IncludeInDiffuese
		ディフューズの陰影に合成され影色で描画されます。

	DropAsAShadow
		ディフューズの陰影とは別に影として描画され、個別に色指定します。

SystemShadowColor
	ShadowColorと同様にテクスチャでシステムシャドウの色指定が出来ます。
	テクスチャが未指定の場合、カラーピッカーで設定した色が使用されます。
	（アルファは無効）

--------------------------------------------------
Hilight Settings
--------------------------------------------------
HilightMap
    ハイライトの出現するエリアとその周りに滲む色を指定するテクスチャを設定します。
    テクスチャが未指定の場合カラーピッカーで指定した色が使用され、出現エリアは全面となります。

Toon(Hilight)
    ハイライトの出方とその周りの色の滲み方を指定します。

Hilight Intensity
    ハイライトの総合での強さを設定します。

Hilight in Shadow
    影になる部分でのハイライト強さを設定します。
    ゼロにすると影の部分ではハイライトが出なくなります。

Hilight Hardness
    ハイライトの硬さを設定します。
    Toonを通す前の値は、数値が小さいとぼやけた感じ、大きくするとクッキリした感じになります。

Hilight Power
    ハイライトの部分の強さを調整します。

Color Spread
    ハイライトの周りの色の滲みの強さを設定します。
    ゼロにすると滲みの色が出なくなります。
    Toonでの設定でも調整可能ですが、そこから更に調整する場合に利用します。

--------------------------------------------------
--------------------------------------------------
Outline Edge Settings
Toon02Edge / Toon02FadeEdge
--------------------------------------------------
Edge Color
    アウトラインの色を設定します。

BaseColorMixing
    アウトラインに基本色を合成するかどうかを設定します。

Mixing strength
    合成する場合、その強さを設定します。

ShadowColorMixing
    アウトラインに影色を合成するかどうかを設定します。
Mixing strength
    合成する場合、その強さを設定します。

Edge Tchickness
    アウトラインの太さを設定します。

VColor(R) to Edge
    頂点カラーの赤色成分を利用してアウトラインの入り抜きなどの太さ制御を利用するかどうかを設定します。
    1の時最大でEdgeTchicknessで設定した太さ、
	ゼロの時アウトラインが消えます。
--------------------------------------------------
--------------------------------------------------
Version History

2021/05/07 v1.0.8
　・FOVの変化でアウトラインの太さが極端に変わっていた症状を修正。
　・アウトラインの太さ維持の方法を一定距離以内のみ太さ調整するように変更。
　　カメラから1.5メートル程の位置にTポーズモデルを置き左手先端側から右手先端を見ているとき、全てのアウトラインがほぼ同じ太さになるように調整しました。

2021/05/05 v1.0.7
　・以前VRChat利用時に起こっていた不具合がunity2018に移行した事で解消され、逆に不具合を起こしていた物を修正。
　　VRChatのミラー内での表示対処の為のコードにより起こっていた不具合を修正しました。
　・VRChatがunity2018に移行したことでレンダーキュー関連の不具合が解消され、複数のファイルを用意する必要がなくなった為、VRChat用のサンプルファイルを削除しました。
　・２つのパラメータを追加
　　・AnchorPoint
　　　　メッシュに設定したアンカーオーバーライドが効かない場合の応急処置。
　　　　メッシュの属するFBXファイルに含まれるもの以外は効果が無いようです。
　　　　(unity上、VRChat内で確認。
　　・AmbientTilt
　　　　人体モデルなどで足元付近の影響が強すぎて見える場合などの調整用。
　・unity2019に対応したシェーダーを暫定的に追加。
　　　#pragmaキーワードが変更になっているため、
　　　2018までのシェーダーは2019以降で、
　　　2019以降用のシェーダーは2018以前で不具合が起こります。

2019/05/01	v1.0.6
　・VRChatで利用時、アバター選択UIを表示すると一部の表示がおかしくなっていた不具合を修正。
　・VRChatでVR環境利用時に、アウトライン用のメッシュがズレて表示される事がある不具合に暫定対応。
　・VRChatで利用する為のRenderQueue指定シェーダーを使用シェーダーに設定した際、
　　ファイル指定のRenderTypeとRenderQueueを自動で設定するように変更。
	RenderingSettingsのRendering Mode、Render　Queue、SrcBlend、DstBlendが対象。
	Render Type Cutoutの場合のみ追加でColorMask、AlphaToMaskが対象。
　　選択時にシェーダー名で判断する為、シェーダー名に必要な文字列が含まれている事が条件です。
　　「vrc」「cutout」「fade」「transparent」
　・メインのライト以外のライティング処理の見直しと修正。
　　複数ライティングによって塗分け部分が何重にも重なる現象防止の為、
　　BasePassで利用可能なライト情報全ての中で一番明るい方向に光源があるものとして処理します。
　　追加のピクセルライティング(AddPass)で処理されるライトは情報が取れない為、これに含まれません。
	方向を示す情報が無い場合、ワールド空間上でカメラの上方に光源があるものとして処理します。
　・ビュー方向固定だったハイライトをライティング方向によってある程度変化するように変更。
　・以下の5項目のパラメータ追加と、１項目のパラメータの動作変更をしました。
　　追加パラメータ
　　・ColorMask
　　　書き込みチャンネルの設定。チェック有りで書き込み。
　　・AlphaToMask
　　　アルファチャンネルをマスクするかどうか。チェックでマスク有り。
　　・Expand Spherically
　　　面法線を球状に拡張します。1で完全な球状。
　　・Spherical Center
　　　球状に拡張する際の中心位置を指定。0でMeshの中心位置。
　　　同一オブジェクト内でMeshが分かれている場合、MeshRenderer>>Bounds>>Centerの値を指定する事でそのMeshの中心を指定出来ます。
　　・AmbientLight Color
　　　MainLightingAffcetに含まれる環境光の成分をそのまま使うか明るさ情報のみとして利用するか指定します。
　　　メインのライティングはそのままに環境光の色成分だけ弱めたい時などに調整します。
　　　0で明るさのみ、1で通常の色。
　　変更パラメータ
　　・Lighting Direction
　　　View と Light を混合出来るようにスライダー設定に変更。
　　　0が以前のView、1が以前のLightに相当します。
　　　内部数値に変更は無いので、以前の設定はそのまま維持されます。

2019/04/12	v1.0.5
　・ハイライトが一定の角度で極端に面積が広がる現象を回避出来るよう修正。
　・裏面を表示する設定の場合に起こるシステムシャドウの余分な効果を軽減。
　（仕組み上裏面には正しく影を落とせない為、すでに影が落ちているという方向で調整。）
　・中距離でのアウトラインの変化を調整。

2019/04/06	v1.0.4
　・追加のライティングがベースパスのライティングと合っていなかった為に発生していた不具合を修正。
　・直接光と環境光の合成具合をStandardShaderの挙動と同程度に見えるように調整。
　・シェーダーの再読み込みをするまでハイライトが無効にならなかった不具合を修正。
　・ハイライトの色の出具合を調整。
　・追加のライティングのシステムシャドウの調整用パラメータを追加。
　・VRChatで利用時に必要なレンダーキュー変更シェーダーのサンプルを2個追加。

2018/12/12	v1.0.3
　・unity2017に合わせて色の出具合を調整。
　・白飛び飽和値の調整用のプロパティを追加。

2018/12/04	v1.0.2
　・特定の条件でTypeAedge.cgincでエラーが出ていたのを修正。
　・サンプルのテクスチャの色を一部調整。
　・VRC用サンプルシェーダにレンダーキュー・タイプ共にTransparentの物を追加。

2018/09/28	v1.0.1
　・Lighting Direction が Lightの時、半透明部分の陰影がおかしかったのを修正
　・Rendering Mode が Cutout の時、半透明部分に追加のライト効果がのらなかったのを修正
　・Sceneタブやマテリアルプレビューでは透過しているのにgameタブでは透過されていない場合があったのを修正
　・VRChatで使用する為のファイルコピーのベースになる基本シェーダーを追加
　・ReadMeの記載を一部変更

2018/09/24	v1.0.0
　・First release
